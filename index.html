<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trading Journal</title>

  <link rel="stylesheet" href="style.css" />
  <!-- <link rel="manifest" href="manifest.json" /> -->
</head>
<body>

  <h1>üìí Trading Journal</h1>

  <div id="pnlCard" class="pnl neutral">
    <span>PnL</span>
    <strong id="pnlValue">$0.00</strong>
  </div>

  <!-- FILTROS -->
  <div class="filters">
    <select id="historyRange">
      <option value="TODAY">Hoy</option>
      <option value="7D">√öltimos 7 d√≠as</option>
      <option value="30D">√öltimos 30 d√≠as</option>
      <option value="ALL">Todo</option>
    </select>

    <select id="statusView">
      <option value="OPEN_ONLY">Mostrar: Abiertas</option>
      <option value="CLOSED_ONLY">Mostrar: Cerradas</option>
      <option value="ALL">Mostrar: Todo</option>
    </select>

    <select id="viewMode">
      <option value="TRADES">Ver: Trades</option>
      <option value="SPREADS">Ver: Spreads</option>
      <option value="POSITIONS">Ver: Posiciones</option>
    </select>

    <button type="button" id="repairBtn" title="Detecta y repara patas fantasmas / duplicados">üß∞ Reparar</button>

    <select id="brokerFilter">
      <option value="ALL">Broker: Todos</option>
      <option value="SIGMA_TRADE">Sigma Trade</option>
      <option value="THINKORSWIM">ThinkorSwim</option>
      <option value="ROBINHOOD">Robinhood</option>
      <option value="WEBULL">Webull</option>
    </select>

    <input type="text" id="tickerSearch" placeholder="Buscar ticker (SPY, AAPL...)" autocomplete="off" />
  </div>

  <form id="tradeForm">
    <div class="field">
      <input type="date" id="fecha" required />
      <label for="fecha">Fecha</label>
    </div>

    <div class="field">
      <input type="time" id="hora" required />
      <label for="hora">Hora</label>
    </div>

    <input type="text" id="ticker" placeholder="Ticker" required />

    <select id="broker" required>
      <option value="">Broker</option>
      <option value="SIGMA_TRADE">Sigma Trade</option>
      <option value="THINKORSWIM">ThinkorSwim</option>
      <option value="ROBINHOOD">Robinhood</option>
      <option value="WEBULL">Webull</option>
    </select>

    <select id="categoria" required>
      <option value="">Categor√≠a</option>
      <option value="DIRECCIONALES">Direccionales</option>
      <option value="INGRESOS">Ingresos</option>
      <option value="VOLATILIDAD">Volatilidad</option>
      <option value="SPREADS">Spreads</option>
    </select>

    <select id="estrategia" required>
      <option value="">Estrategia</option>
    </select>

    <input id="position_id" placeholder="(auto) position_id" readonly />

    <select id="pata">
      <option value="">Pata</option>
      <option value="SHORT">SHORT</option>
      <option value="LONG">LONG</option>
      <option value="STOCK">STOCK</option>
    </select>

    <!-- Tipo de contrato (solo opciones). Se oculta cuando Pata=STOCK -->
    <select id="tipo_opcion">
      <option value="">Tipo (CALL/PUT)</option>
      <option value="CALL">CALL</option>
      <option value="PUT">PUT</option>
    </select>

    <select id="accion">
      <option value="OPEN">OPEN</option>
      <option value="CLOSE">CLOSE</option>
      <option value="ROLL_CLOSE">ROLL_CLOSE</option>
      <option value="ROLL_OPEN">ROLL_OPEN</option>
    </select>

    <input id="roll_group_id" type="hidden" />

    <select id="estado" required>
      <option value="OPEN">OPEN</option>
      <option value="CLOSED">CLOSED</option>
    </select>

    <div class="field">
      <input type="date" id="expiracion" />
      <label for="expiracion">Fecha de expiraci√≥n</label>
    </div>

    <input type="text" id="strikes" placeholder="Strikes" />

    <!-- Multi-leg builder (solo spreads) -->
    <div id="multiLegWrap" class="ml-wrap">
      <div class="ml-head">
        <label class="ml-check">
          <input type="checkbox" id="multiLegEnabled" />
          Entrar m√∫ltiples patas (1 trade)
        </label>

        <button type="button" id="genLegsBtn" class="ml-btn">
          Generar patas
        </button>

        <small class="ml-help">
          Formatos: <b>PCS/CCS</b> ‚Äú440/435‚Äù o ‚ÄúS:440 L:435‚Äù ‚Ä¢ <b>IC</b> ‚Äú450/455/430/425‚Äù (SC/LC/SP/LP) o ‚ÄúSC:450 LC:455 SP:430 LP:425‚Äù
        </small>
      </div>

      <div id="legsTable" class="ml-table"></div>

      <small class="ml-note">
        Nota: en multi-patas, t√∫ llenas el precio de <b>entrada</b> por pata. Para cerrar, usa ‚ÄúCerrar pata‚Äù en la lista (igual que ahora).
      </small>
    </div>

    <!-- Modo NETO -->
    <label class="net-wrap">
      <input type="checkbox" id="netMode" />
      Guardar como NETO (1 precio)
    </label>

    <!-- ENTRADA -->
    <select id="entrada_tipo" required>
      <option value="CREDITO">Entrada: Cr√©dito (+)</option>
      <option value="DEBITO">Entrada: D√©bito (-)</option>
    </select>
    <input type="number" step="0.01" id="credito_debito" placeholder="Entrada (precio)" />

    <!-- SALIDA -->
    <select id="salida_tipo" required>
      <option value="DEBITO">Salida: D√©bito (-)</option>
      <option value="CREDITO">Salida: Cr√©dito (+)</option>
    </select>
    <input type="number" step="0.01" id="credito_debito_salida" placeholder="Salida (precio)" />

    <input type="number" id="contratos" placeholder="Contratos" />

    <input type="number" step="0.01" id="resultado" placeholder="Resultado $" readonly />

    <input type="text" id="notas" placeholder="Notas" />

    <div class="btnRow">
      <button type="submit" id="saveBtn">Guardar Trade</button>
      <button type="button" id="cancelBtn">Cancelar</button>
    </div>
  </form>

  <h2 id="listTitle">üìÖ Trades</h2>
  <ul id="tradesList"></ul>

  <script src="app.js" defer></script>
</body>
</html>
